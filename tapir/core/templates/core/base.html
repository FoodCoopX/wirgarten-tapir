{% load django_bootstrap5 %}
{% load tapir_static %}
{% load i18n %}
{% load core %}
{% load django_vite %}
{% load configuration %}
{% load wirgarten %}
<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
        {% block title %}{{ "wirgarten.site.name"|parameter }} - Tapir{% endblock %}
    </title>
    <link rel="stylesheet"
          href="{% static 'core/bootstrap/5.1.3/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'core/css/base.css' %}">
    <link rel="stylesheet"
          href="{% static 'core/css/selectize.default.min.css' %}"/>
    {% with "organisation.theme"|parameter as theme %}
        <link rel="stylesheet"
              href="{% static 'core/themes/'|add:theme|add:'/css/custom.css' %}"/>
        <link rel="shortcut icon"
              type="image/png"
              href="{% static 'core/themes/'|add:theme|add:'/favicon.ico' %}"/>
    {% endwith %}
    <link rel="stylesheet"
          href="{% static 'wirgarten/css/loading-spinner.css' %}"/>
    <script src="{% static 'core/jQuery/jquery-3.5.1.min.js' %}"></script>
    <script src="{% static 'core/bootstrap/5.1.3/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'wirgarten/js/moment.min.js' %}"></script>
    <script>moment.locale('de')</script>
    <script src="{% static 'core/js/url-functions.js' %}"></script>
    <script src="{% static 'core/js/selectize.min.js' %}"></script>
    {{ form.media }}
    {% javascript_environment_variables %}
    {% vite_hmr_client %}
    {% vite_react_refresh %}
    {% block head %}{% endblock %}
</head>
<body>
<div id="page-content">
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark sticky-top shadow px-3">
                <span class="navbar-brand">
                    {% with "organisation.theme"|parameter as theme %}
                        <img alt="Wirgarten Logo"
                             height="30"
                             src="{% static 'core/themes/'|add:theme|add:'/images/Logo_white.webp' %}">
                    {% endwith %}
                </span>
        {% if request.user.is_authenticated %}
            <div style="width: 100%; display: flex; justify-content: space-between">
                <a class="text-light nav-link" style="white-space:nowrap"
                   href="/">{{ request.user.first_name }} {{ request.user.last_name }}</a>
                {% if debug %}
                    {% get_parameter_value_tag "wirgarten.tests.override_date_preset" cache as date_preset %}
                    {% if date_preset != "disabled" %}
                        <span class="text-warning nav-link">Datum Ã¼berschrieben: {% get_now_tag cache %}</span>
                    {% endif %}
                {% endif %}
                <form action="{% url 'account_logout' %}" method="post">
                    {% csrf_token %}
                    <button class="btn text-light nav-link" id="logout" type="submit">Logout</button>
                </form>
            </div>
        {% endif %}
    </nav>
    {% include 'wirgarten/generic/modal/form-modal.html' %}
    {% include 'wirgarten/generic/modal/confirmation-modal.html' %}
    <div class="container-fluid" style="padding-right:1em; padding-left:1em;">
        {% if perms.coop.view %}
            <nav id="sidebar" class="bg-light sidebar custom-sidebar">
                <div class="sidebar-sticky">
                    {% block sidebar %}
                        {% sidebar_links %}
                    {% endblock %}
                </div>
            </nav>
        {% endif %}
        <main id="main-content"
              role="main"
              {% if perms.coop.view %}style="margin-left:4em;"{% endif %}>
            {% bootstrap_messages %}
            {% block content %}{% endblock %}
        </main>
    </div>
</div>
</body>
<script src="{% static 'wirgarten/js/table-functions.js' %}"></script>
<script>
    $(function () {
        $('[data-bs-toggle="tooltip"]').tooltip();
    })
    // Style selectize inputs like bootstrap
    $(".searchable-select>select").selectize({plugins: ["clear_button"], sortField: 'text'})
    for (const elem of document.getElementsByClassName('selectize-input')) {
        elem.classList.add('form-select');
        elem.classList.add('is-valid');
    }
</script>
</html>
