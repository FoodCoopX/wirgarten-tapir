{% load django_bootstrap5 %}

<div class="form-fields">
    {% for field in form %}
    <div class="form-field" id="{{ field.name }}">
        {% bootstrap_field field %}
    </div>
    {% endfor %}
</div>
<script>
    const fields = document.getElementsByClassName("form-field");
    const handleDeliveryCycleChange = (value) => {
        for (field of fields){
            if(field.id.startsWith("plc_")){
                field.style.display = value === "no_delivery" ? "none" : "block";
            }
        }
        parent.postMessage({type:"modal-content-resized"}, "*");
    }

    const nameField = document.getElementById("name");
    const nameInput = document.getElementById("id_name");

    const handleProductTypeChange = (value) => {
        const selected = value.trim().length > 0;
        nameField.style.display = selected ? "none" : "block";
        nameInput.required = !selected;
    }

    const productTypeSelect = document.getElementById("id_product_type");
    if(productTypeSelect){
        productTypeSelect.addEventListener("change", (e) => handleProductTypeChange(e.target.value));
        handleProductTypeChange(productTypeSelect.value);
    }

    const deliveryCycleSelect = document.getElementById("id_delivery_cycle")
    deliveryCycleSelect.addEventListener("change", (e) => handleDeliveryCycleChange(e.target.value))

    handleDeliveryCycleChange(deliveryCycleSelect.value);
</script>