{% extends "accounts/base.html" %}

{% load django_bootstrap5 %}
{% load static %}
{% load i18n %}
{% load wirgarten %}

{% block head %}
<script src="{% static 'wirgarten/js/moment.min.js' %}"></script>
{% endblock %}


{% block content %}
<div style="margin:2em" class="container">
    <div class="card">
        <div class="card-header">
            <h5>Zahlungen - {{member.first_name}} {{member.last_name}}</h5>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                <tr>
                    <th style="text-align:center">
                        {% translate 'Datum' %}
                    </th>
                    <th style="text-align:center">
                        {% translate 'Mandatsreferenz' %}
                    </th>
                    <th style="text-align:center">
                        {% translate 'Betrag' %}
                    </th>
                </tr>
                </thead>
                <tbody>
                {% for payment in payments %}
                <tr>
                    <td style="text-align:center">
                        <strong id="date-{{payment.due_date}}">{{payment.date}}</strong><br/>
                        <p style="line-height:1.25em"><small id="datediff-{{payment.due_date}}"></small></p>
                        <h5><span class="rounded-pill badge bg-{%if payment.status == 'DUE' %}danger{%elif payment.status == 'UPCOMING' %}info{%elif payment.status == 'PAID' %}success{%endif%}">{{payment.status}}</span></h5>
                    </td>
                    <td style="text-align:center">
                        <strong>{{payment.mandate_ref.pk}}</strong><br/>
                        <p style="line-height:1.25em">
                            <small>
                                {% for sub in payment.subs %}
                                {{sub.quantity}} × {{sub.product.name}} {{sub.product.type.name}}<br/>
                                {% endfor %}
                            </small>
                        </p>
                    </td>
                    <td style="text-align:center">
                        <strong>{{payment.amount}} €</strong><br/>

                        <p style="line-height:1.25em">
                            <small>
                                {% for sub in payment.subs %}
                                {{sub.quantity}} × {{sub.product.price}} € {% if sub.solidarity_price is not None and sub.solidarity_price != 0 %} ({% if sub.solidarity_price > 0%}+{% endif %}{% widthratio sub.solidarity_price 1 100 %}%){%endif%}<br/>
                                {% endfor %}
                            </small>
                        </p>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    const now = moment();
    let diff, date;

    {% for payment in payments %}
    date = moment("{{payment.due_date}}");
    diff = now.to(date);
    document.getElementById("datediff-{{payment.due_date}}").innerText = diff;
    document.getElementById("date-{{payment.due_date}}").innerText = date.format("LL");
    {% endfor %}
</script>
{% endblock %}

